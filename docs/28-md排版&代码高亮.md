# 排版 & 高亮

## 准备工作
下载两个依赖，一个是屏蔽 tailwindcss 的整体 reset，一个是负责代码高亮：
```
npm i -D @tailwindcss/typography@0.5.17

npm i markdown-it-highlightjs@4.2.0 
```

## markdown 排版
在主样式文件中引入插件 `typography`：
```css
/* renderer/styles/index.css */

@plugin "@tailwindcss/typography";
```
在流式渲染组件中，引入 `prose` 类，一键搞定标准化排版样式：
```vue
<!-- renderer/components/MessageRender.vue -->

 <!-- prose 类：屏蔽tailwindcss的reset，prose-pre去除代码块默认的padding框 -->
    <VueMarkdown class='prose dark:prose-invert prose-slate prose-pre:p-0 prose-headings:pt-3 text-inherit' 
    :id="renderId" :source="content" 
    />
```


## 代码高亮
在主入口文件，由于 `hljs` 只识别 html 语言的代码块，需要人为添加识别语言：
```ts
// renderer/index.ts

import hljs from 'highlight.js/lib/core'
import xml from 'highlight.js/lib/languages/xml'

/* 
  后续可以根据需要引入其他语言识别
*/
// 识别vue为xml语言
hljs.registerLanguage('vue', xml)
```
在流式渲染组件中，引入 `hljs` 插件：
```vue
 <VueMarkdown class='prose dark:prose-invert prose-slate prose-pre:p-0 prose-headings:pt-3 text-inherit' 
    :plugins="[markdownItHighlightjs]"
    :id="renderId" :source="content" 
    />
```
明暗主题上也要对代码高亮做调整，这里用了 github 的代码块样式：
```css
/* renderer/styles/theme/dark.css */

@media (prefers-color-scheme: dark) {
  :root {
    --primary-color: #07C160;
    --bg-color: #1E1E1E;
    --bg-secondary: #2C2C2C;

    --text-primary: #E0E0E0;
    --text-secondary: #A0A0A0;

    --bubble-self: var(--primary-color);
    --bubble-others: #3A3A3A;
    --input-bg: #333333;
    --ripple-color: var(--text-secondary);
    --ripple-opacity: 0.2;
  }

  pre code.hljs {
    display: block;
    overflow-x: auto;
    padding: 1em
  }
  code.hljs {
    padding: 3px 5px
  }
  /*!
    Theme: GitHub Dark
    Description: Dark theme as seen on github.com
    Author: github.com
    Maintainer: @Hirse
    Updated: 2021-05-15

    Outdated base version: https://github.com/primer/github-syntax-dark
    Current colors taken from GitHub's CSS
  */
  .hljs {
    color: var(--text-primary);
    background: var(--input-bg);
  }
  .hljs-doctag,
  .hljs-keyword,
  .hljs-meta .hljs-keyword,
  .hljs-template-tag,
  .hljs-template-variable,
  .hljs-type,
  .hljs-variable.language_ {
    /* prettylights-syntax-keyword */
    color: #ff7b72
  }
  .hljs-title,
  .hljs-title.class_,
  .hljs-title.class_.inherited__,
  .hljs-title.function_ {
    /* prettylights-syntax-entity */
    color: #d2a8ff
  }
  .hljs-attr,
  .hljs-attribute,
  .hljs-literal,
  .hljs-meta,
  .hljs-number,
  .hljs-operator,
  .hljs-variable,
  .hljs-selector-attr,
  .hljs-selector-class,
  .hljs-selector-id {
    /* prettylights-syntax-constant */
    color: #79c0ff
  }
  .hljs-regexp,
  .hljs-string,
  .hljs-meta .hljs-string {
    /* prettylights-syntax-string */
    color: #a5d6ff
  }
  .hljs-built_in,
  .hljs-symbol {
    /* prettylights-syntax-variable */
    color: #ffa657
  }
  .hljs-comment,
  .hljs-code,
  .hljs-formula {
    /* prettylights-syntax-comment */
    color: #8b949e
  }
  .hljs-name,
  .hljs-quote,
  .hljs-selector-tag,
  .hljs-selector-pseudo {
    /* prettylights-syntax-entity-tag */
    color: #7ee787
  }
  .hljs-subst {
    /* prettylights-syntax-storage-modifier-import */
    color: #c9d1d9
  }
  .hljs-section {
    /* prettylights-syntax-markup-heading */
    color: #1f6feb;
    font-weight: bold
  }
  .hljs-bullet {
    /* prettylights-syntax-markup-list */
    color: #f2cc60
  }
  .hljs-emphasis {
    /* prettylights-syntax-markup-italic */
    color: #c9d1d9;
    font-style: italic
  }
  .hljs-strong {
    /* prettylights-syntax-markup-bold */
    color: #c9d1d9;
    font-weight: bold
  }
  .hljs-addition {
    /* prettylights-syntax-markup-inserted */
    color: #aff5b4;
    background-color: #033a16
  }
  .hljs-deletion {
    /* prettylights-syntax-markup-deleted */
    color: #ffdcd7;
    background-color: #67060c
  }
}

```
```css
/* renderer/styles/theme/light.css */

@media (prefers-color-scheme: light) {
  :root {
    --primary-color: #07C160;
    --bg-color: #FFFFFF;
    --bg-secondary: #F5F5F5;
    --text-primary: #000000;
    --text-secondary: #7F7F7F;

    --header-bg: var(--primary-color);
    --bubble-self: var(--primary-color);
    --bubble-others: #FFFFFF;
    --input-bg: #F0F0F0;
    --ripple-color: var(--text-secondary);
    --ripple-opacity: 0.2;
  }
  
  pre code.hljs {
    display: block;
    overflow-x: auto;
    padding: 1em
  }
  code.hljs {
    padding: 3px 5px
  }
  /*!
    Theme: GitHub
    Description: Light theme as seen on github.com
    Author: github.com
    Maintainer: @Hirse
    Updated: 2021-05-15

    Outdated base version: https://github.com/primer/github-syntax-light
    Current colors taken from GitHub's CSS
  */
  .hljs {
    /* color: #24292e;
    background: #ffffff */

    color: var(--text-primary);
    background: var(--input-bg);
  }
  .hljs-doctag,
  .hljs-keyword,
  .hljs-meta .hljs-keyword,
  .hljs-template-tag,
  .hljs-template-variable,
  .hljs-type,
  .hljs-variable.language_ {
    /* prettylights-syntax-keyword */
    color: #d73a49
  }
  .hljs-title,
  .hljs-title.class_,
  .hljs-title.class_.inherited__,
  .hljs-title.function_ {
    /* prettylights-syntax-entity */
    color: #6f42c1
  }
  .hljs-attr,
  .hljs-attribute,
  .hljs-literal,
  .hljs-meta,
  .hljs-number,
  .hljs-operator,
  .hljs-variable,
  .hljs-selector-attr,
  .hljs-selector-class,
  .hljs-selector-id {
    /* prettylights-syntax-constant */
    color: #005cc5
  }
  .hljs-regexp,
  .hljs-string,
  .hljs-meta .hljs-string {
    /* prettylights-syntax-string */
    color: #032f62
  }
  .hljs-built_in,
  .hljs-symbol {
    /* prettylights-syntax-variable */
    color: #e36209
  }
  .hljs-comment,
  .hljs-code,
  .hljs-formula {
    /* prettylights-syntax-comment */
    color: #6a737d
  }
  .hljs-name,
  .hljs-quote,
  .hljs-selector-tag,
  .hljs-selector-pseudo {
    /* prettylights-syntax-entity-tag */
    color: #22863a
  }
  .hljs-subst {
    /* prettylights-syntax-storage-modifier-import */
    color: #24292e
  }
  .hljs-section {
    /* prettylights-syntax-markup-heading */
    color: #005cc5;
    font-weight: bold
  }
  .hljs-bullet {
    /* prettylights-syntax-markup-list */
    color: #735c0f
  }
  .hljs-emphasis {
    /* prettylights-syntax-markup-italic */
    color: #24292e;
    font-style: italic
  }
  .hljs-strong {
    /* prettylights-syntax-markup-bold */
    color: #24292e;
    font-weight: bold
  }
  .hljs-addition {
    /* prettylights-syntax-markup-inserted */
    color: #22863a;
    background-color: #f0fff4
  }
  .hljs-deletion {
    /* prettylights-syntax-markup-deleted */
    color: #b31d28;
    background-color: #ffeef0
  }
}
```